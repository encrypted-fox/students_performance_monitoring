&НаКЛиенте
Процедура Выгрузка(Команда)
    ВыгрузитьВCSV("C:\Users\aleks\Desktop\my.csv");
КонецПроцедуры

// Запрос к справочнику Номенклатуры для получения таблицы значений
Функция ПолучитьНоменклатуру()
    Запрос = Новый Запрос;
    Запрос.Текст =
        "ВЫБРАТЬ ПЕРВЫЕ 1000
        |    Номенклатура.Ссылка,
        |    Номенклатура.Код,
        |   Номенклатура.Родитель,
        |    Номенклатура.Наименование
        |ИЗ
        |    Справочник.Номенклатура КАК Номенклатура";
    Результат = Запрос.Выполнить();
    ТаблицаЗначений = Результат.Выгрузить();
    возврат ТаблицаЗначений;
КонецФункции

// Создание строки заголовков для CSV-файла
Функция СоздатьЗаголовкиCSV(ТаблицаЗначений,разделитель)
    //разделитель = "|";
    колонкиТЗ=ТаблицаЗначений.колонки;
    Для каждого колонка Из колонкиТЗ Цикл
        стрКолонки = "" + стрКолонки + колонка.Имя + разделитель ;
    КонецЦикла;
    Возврат стрКолонки;
КонецФункции

// Создание текста CSV: текст заголовков и текст данных
Функция СоздатьДанныеCSV(ТаблицаЗначений,разделитель)
    текст="";
    для каждого запись из ТаблицаЗначений Цикл
        если текст="" тогда
            текст=СоздатьЗаголовкиCSV(ТаблицаЗначений,разделитель)
                + Символы.ПС;
        КонецЕсли;

        сообщить(запись.Наименование);
        текст = текст + запись.Ссылка
            + разделитель + запись.Код
            + разделитель + запись.Родитель
            + разделитель + запись.Наименование
            + Символы.ПС;
    КонецЦикла;
        //сообщить(текст);
    Возврат текст;
КонецФункции

// Запись данных в файл
Функция ЗаписатьCSV(текст,имяФайла)
    кодировка = КодировкаТекста.ANSI;

    ТекстовыйФайлЗапись = Новый ЗаписьТекста(имяФайла,Кодировка);
    ТекстовыйФайлЗапись.ЗаписатьСтроку(текст);
    ТекстовыйФайлЗапись.Закрыть();
    Возврат 0;
КонецФункции

// Основная логика:
Функция ВыгрузитьВCSV(имяФайлаCSV);
    разделитель = "|";
    ТаблицаЗначений = ПолучитьНоменклатуру();
    текст = СоздатьДанныеCSV(ТаблицаЗначений,разделитель);
    ЗаписатьCSV(текст,имяФайлаCSV);
КонецФункции
